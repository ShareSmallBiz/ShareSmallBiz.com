@model List<DiscussionModel>

<section class="container my-5">
    <div class="accordion" id="postAccordion">
        @foreach (var post in Model)
        {
            var postId = $"collapse{post.Id}"; // Ensure unique ID

            <article class="accordion-item">
                <h2 class="accordion-header" id="heading@post.Id">
                    <button class="accordion-button"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#@postId"
                            aria-expanded="false"
                            aria-controls="@postId">
                        <i class="bi bi-file-earmark-post me-2"></i>@post.Title
                    </button>
                </h2>
                <div id="@postId" class="accordion-collapse collapse show"
                     aria-labelledby="heading@post.Id">
                    <div class="accordion-body">
                        <div class="d-flex flex-column align-items-center text-center mb-3">
                            @if (!string.IsNullOrEmpty(post.Cover) && post.Cover != "https://sharesmallbiz.com/")
                            {
                                <img src="@post.Cover" alt="@post.Title" class="img-fluid rounded" style="width: 100%; max-height: 250px; object-fit: cover;">
                            }

                            <div class="mt-3 w-100">
                                <p class="mb-1 text-muted">
                                    @if (post?.Author?.ProfilePicture != null)
                                    {
                                        <img class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;"
                                             src="data:image/*;base64,@(Convert.ToBase64String(post.Author.ProfilePicture))" alt="User Profile">
                                    }
                                    else
                                    {
                                        <i class="bi bi-person-circle"></i>
                                    }
                                    <strong>
                                        @if (!string.IsNullOrEmpty(post?.Author?.UserName))
                                        {
                                            <a href="/profiles/@post.Author.UserName">@post.Author.UserName</a>
                                        }
                                        else
                                        {
                                            @:Unknown
                                        }
                                    </strong>
                                    • <i class="bi bi-eye"></i> @(post.PostViews) views
                                    • <i class="bi bi-chat"></i> @(post.Comments.Count) comments
                                </p>
                                <p>@post.Description</p>
                                <a href="/Discussions/@post.Id/@post.Slug" class="btn btn-outline-primary">
                                    <i class="bi bi-arrow-right-circle"></i> Read Full Post
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        }
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var accordions = document.querySelectorAll('.accordion-button');
            accordions.forEach(button => {
                button.addEventListener('click', function () {
                    var target = document.querySelector(this.getAttribute('data-bs-target'));
                    if (target.classList.contains('show')) {
                        target.classList.remove('show');
                    } else {
                        target.classList.add('show');
                    }
                });
            });
        });
    </script>
}
